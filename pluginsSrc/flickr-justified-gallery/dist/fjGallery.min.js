!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).fjGallery=e()}(this,function(){"use strict";let t;var o=t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t,e,i){var r,h,c,l,d,g,u,p,i=(i||{}).atBegin;return r=t,h=e,l=void 0!==(e=(t={debounceMode:!1!==(void 0!==i&&i)}).noTrailing)&&e,d=void 0!==(e=t.noLeading)&&e,g=void 0===(e=t.debounceMode)?void 0:e,u=!1,p=0,o.cancel=function(t){t=(t||{}).upcomingOnly,t=void 0!==t&&t;f(),u=!t},o;function f(){c&&clearTimeout(c)}function o(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var o=this,n=Date.now()-p;function a(){p=Date.now(),h.apply(o,e)}function s(){c=void 0}u||(d||!g||c||a(),f(),void 0===g&&r<n?d?(p=Date.now(),l||(c=setTimeout(g?s:a,r))):a():!0!==l&&(c=setTimeout(g?s:a,void 0===g?r-n:r)))}}var s=function(o){function t(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n=e,a=a||requestAnimationFrame(function(){a=null,o.apply(void 0,n)})}var n,a=null;return t.cancel=function(){a&&(cancelAnimationFrame(a),a=null)},t},e={exports:{}},n=((e.exports=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight,this.widowLayoutStyle=t.widowLayoutStyle,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(t){var e,i,o,n=this.items.concat(t),a=this.width-(n.length-1)*this.spacing,n=n.reduce(function(t,e){return t+e.aspectRatio},0),s=a/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&1<=t.aspectRatio?(this.items.push(t),this.completeLayout(a/t.aspectRatio,"justify"),!0):n<this.minAspectRatio?(this.items.push(Object.assign({},t)),!0):n>this.maxAspectRatio&&0!==this.items.length&&(e=this.width-(this.items.length-1)*this.spacing,i=this.items.reduce(function(t,e){return t+e.aspectRatio},0),o=e/this.targetRowHeight,Math.abs(n-s)>Math.abs(i-o))?(this.completeLayout(e/i,"justify"),!1):(this.items.push(Object.assign({},t)),this.completeLayout(a/n,"justify"),!0)},isLayoutComplete:function(){return 0<this.height},completeLayout:function(t,e){var i,o,n,a,s,r=this.left,h=this.width-(this.items.length-1)*this.spacing;(void 0===e||["justify","center","left"].indexOf(e)<0)&&(e="left"),i=t!==(o=Math.max(this.edgeCaseMinRowHeight,Math.min(t,this.edgeCaseMaxRowHeight)))?h/(this.height=o)/(h/t):(this.height=t,1),this.items.forEach(function(t){t.top=this.top,t.width=t.aspectRatio*this.height*i,t.height=this.height,t.left=r,r+=t.width+this.spacing},this),"justify"===e?(r-=this.spacing+this.left,n=(r-this.width)/this.items.length,a=this.items.map(function(t,e){return Math.round((e+1)*n)}),1===this.items.length?this.items[0].width-=Math.round(n):this.items.forEach(function(t,e){0<e?(t.left-=a[e-1],t.width-=a[e]-a[e-1]):t.width-=a[e]})):"center"===e&&(s=(this.width-r)/2,this.items.forEach(function(t){t.left+=s+this.spacing},this))},forceComplete:function(t,e){"number"==typeof e?this.completeLayout(e,this.widowLayoutStyle):this.completeLayout(this.targetRowHeight,this.widowLayoutStyle)},getItems:function(){return this.items}},e.exports);function b(t,e){var i;return!1!==t.fullWidthBreakoutRowCadence&&(e._rows.length+1)%t.fullWidthBreakoutRowCadence==0&&(i=!0),new n({top:e._containerHeight,left:t.containerPadding.left,width:t.containerWidth-t.containerPadding.left-t.containerPadding.right,spacing:t.boxSpacing.horizontal,targetRowHeight:t.targetRowHeight,targetRowHeightTolerance:t.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*t.targetRowHeight,edgeCaseMaxRowHeight:2*t.targetRowHeight,rightToLeft:!1,isBreakoutRow:i,widowLayoutStyle:t.widowLayoutStyle})}function R(t,e,i){return e._rows.push(i),e._layoutItems=e._layoutItems.concat(i.getItems()),e._containerHeight+=i.height+t.boxSpacing.vertical,i.items}const r=[],i=s(()=>{r.forEach(t=>{t.resize()})});o.addEventListener("resize",i),o.addEventListener("orientationchange",i),o.addEventListener("load",i),e=()=>{i()},"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e,{capture:!0,once:!0,passive:!0});let h=0;class c{constructor(t,e){const i=this,o=(i.instanceID=h,h+=1,i.$container=t,i.images=[],i.defaults={itemSelector:".fj-gallery-item",imageSelector:"img",gutter:10,rowHeight:320,rowHeightTolerance:.25,maxRowsCount:Number.POSITIVE_INFINITY,lastRow:"left",transitionDuration:"0.3s",calculateItemsHeight:!1,resizeDebounce:100,isRtl:"rtl"===i.css(i.$container,"direction"),onInit:null,onDestroy:null,onAppendImages:null,onBeforeJustify:null,onJustify:null},i.$container.dataset||{}),n={};Object.keys(o).forEach(t=>{var e=t.substr(0,1).toLowerCase()+t.substr(1);e&&void 0!==i.defaults[e]&&(n[e]=o[t])}),i.options={...i.defaults,...n,...e},i.pureOptions={...i.options},i.resize=a(i.options.resizeDebounce,i.resize),i.justify=s(i.justify.bind(i)),i.init()}css(e,i){return"string"==typeof i?o.getComputedStyle(e).getPropertyValue(i):(Object.keys(i).forEach(t=>{e.style[t]=i[t]}),e)}applyTransition(t,e){this.onTransitionEnd(t)(),this.css(t,{"transition-property":e.join(", "),"transition-duration":this.options.transitionDuration}),t.addEventListener("transitionend",this.onTransitionEnd(t,e),!1)}onTransitionEnd(t){const e=this;return()=>{e.css(t,{"transition-property":"","transition-duration":""}),t.removeEventListener("transitionend",e.onTransitionEnd(t))}}addToFjGalleryList(){r.push(this),i()}removeFromFjGalleryList(){const i=this;r.forEach((t,e)=>{t.instanceID===i.instanceID&&r.splice(e,1)})}init(){var t=this;t.appendImages(t.$container.querySelectorAll(t.options.itemSelector)),t.addToFjGalleryList(),t.options.onInit&&t.options.onInit.call(t)}appendImages(t){const g=this;(t=o.jQuery&&t instanceof o.jQuery?t.get():t)&&t.length&&(t.forEach(t=>{if(t&&!t.fjGalleryImage&&t.querySelector){const d=t.querySelector(g.options.imageSelector);d&&(t.fjGalleryImage=g,(t={$item:t,$image:d,width:parseFloat(d.getAttribute("width"))||!1,height:parseFloat(d.getAttribute("height"))||!1,loadSizes(){const o=this;{var n=d,a=t=>{o.width===t.width&&o.height===t.height||(o.width=t.width,o.height=t.height,g.resize())};let t,e=!1,i=!1;const s=()=>{e?a(e):n.naturalWidth&&(e={width:n.naturalWidth,height:n.naturalHeight},a(e),clearInterval(t),i)&&l()},r=()=>{s()},h=()=>{s()},c=()=>{0<n.naturalWidth&&s()},l=()=>{i=!1,n.removeEventListener("load",r),n.removeEventListener("error",h)};c(),e||(i=!0,n.addEventListener("load",r),n.addEventListener("error",h),t=setInterval(c,100))}}}).loadSizes(),g.images.push(t))}}),g.options.onAppendImages&&g.options.onAppendImages.call(g,[t]),g.justify())}justify(){const i=this,o=[],n=(i.justifyCount=(i.justifyCount||0)+1,i.options.onBeforeJustify&&i.options.onBeforeJustify.call(i),i.images.forEach(t=>{t.width&&t.height&&o.push(t.width/t.height)}),{containerWidth:i.$container.getBoundingClientRect().width,containerPadding:{top:parseFloat(i.css(i.$container,"padding-top"))||0,right:parseFloat(i.css(i.$container,"padding-right"))||0,bottom:parseFloat(i.css(i.$container,"padding-bottom"))||0,left:parseFloat(i.css(i.$container,"padding-left"))||0},boxSpacing:i.options.gutter,targetRowHeight:i.options.rowHeight,targetRowHeightTolerance:i.options.rowHeightTolerance,maxNumRows:i.options.maxRowsCount,showWidows:"hide"!==i.options.lastRow}),a=(t=o,e=n,d={},g={},u={containerWidth:1060,containerPadding:10,boxSpacing:10,targetRowHeight:320,targetRowHeightTolerance:.25,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:!1,showWidows:!0,fullWidthBreakoutRowCadence:!1,widowLayoutStyle:"left"},p={},f={},e=e||{},d=Object.assign(u,e),p.top=isNaN(parseFloat(d.containerPadding.top))?d.containerPadding:d.containerPadding.top,p.right=isNaN(parseFloat(d.containerPadding.right))?d.containerPadding:d.containerPadding.right,p.bottom=isNaN(parseFloat(d.containerPadding.bottom))?d.containerPadding:d.containerPadding.bottom,p.left=isNaN(parseFloat(d.containerPadding.left))?d.containerPadding:d.containerPadding.left,f.horizontal=isNaN(parseFloat(d.boxSpacing.horizontal))?d.boxSpacing:d.boxSpacing.horizontal,f.vertical=isNaN(parseFloat(d.boxSpacing.vertical))?d.boxSpacing:d.boxSpacing.vertical,d.containerPadding=p,d.boxSpacing=f,g._layoutItems=[],g._awakeItems=[],g._inViewportItems=[],g._leadingOrphans=[],g._trailingOrphans=[],g._containerHeight=d.containerPadding.top,g._rows=[],g._orphans=[],d._widowCount=0,s=d,r=g,u=t.map(function(t){return t.width&&t.height?{aspectRatio:t.width/t.height}:{aspectRatio:t}}),l=[],s.forceAspectRatio&&u.forEach(function(t){t.forcedAspectRatio=!0,t.aspectRatio=s.forceAspectRatio}),u.some(function(t,e){if(isNaN(t.aspectRatio))throw new Error("Item "+e+" has an invalid aspect ratio");if(c=c||b(s,r),h=c.addItem(t),c.isLayoutComplete()){if(l=l.concat(R(s,r,c)),r._rows.length>=s.maxNumRows)return!(c=null);if(c=b(s,r),!h&&(h=c.addItem(t),c.isLayoutComplete())){if(l=l.concat(R(s,r,c)),r._rows.length>=s.maxNumRows)return!(c=null);c=b(s,r)}}}),c&&c.getItems().length&&s.showWidows&&(r._rows.length?(u=r._rows[r._rows.length-1].isBreakoutRow?r._rows[r._rows.length-1].targetRowHeight:r._rows[r._rows.length-1].height,c.forceComplete(!1,u)):c.forceComplete(!1),l=l.concat(R(s,r,c)),s._widowCount=c.getItems().length),r._containerHeight=r._containerHeight-s.boxSpacing.vertical,r._containerHeight=r._containerHeight+s.containerPadding.bottom,{containerHeight:r._containerHeight,widowCount:s._widowCount,boxes:r._layoutItems});var t,e,s,r,h,c,l,d,g,u,p,f;if(a.widowCount&&("center"===i.options.lastRow||"right"===i.options.lastRow)){const o=a.boxes[a.boxes.length-1];let e=n.containerWidth-o.width-o.left;"center"===i.options.lastRow&&(e/=2),"right"===i.options.lastRow&&(e-=n.containerPadding.right);for(let t=1;t<=a.widowCount;t+=1)a.boxes[a.boxes.length-t].left=a.boxes[a.boxes.length-t].left+e}i.options.isRtl&&a.boxes.forEach((t,e)=>{a.boxes[e].left=n.containerWidth-a.boxes[e].left-a.boxes[e].width-n.containerPadding.right+n.containerPadding.left});let w=0,m=0;const y={};i.images.forEach((t,e)=>{if(a.boxes[w]&&t.width&&t.height){if(i.options.calculateItemsHeight&&void 0===y[a.boxes[w].top]&&Object.keys(y).length&&(m+=y[Object.keys(y).pop()]-a.boxes[e-1].height),i.options.transitionDuration&&1<i.justifyCount&&i.applyTransition(t.$item,["transform"]),i.css(t.$item,{display:"",position:"absolute",transform:`translateX(${a.boxes[w].left}px) translateY(${a.boxes[w].top+m}px) translateZ(0)`,width:a.boxes[w].width+"px"}),i.options.calculateItemsHeight){const i=t.$item.getBoundingClientRect();(void 0===y[a.boxes[w].top]||y[a.boxes[w].top]<i.height)&&(y[a.boxes[w].top]=i.height)}w+=1}else i.css(t.$item,{display:"none"})}),i.options.calculateItemsHeight&&Object.keys(y).length&&(m+=y[Object.keys(y).pop()]-a.boxes[a.boxes.length-1].height),i.options.transitionDuration&&i.applyTransition(i.$container,["height"]),i.css(i.$container,{height:a.containerHeight+m+"px"}),i.options.onJustify&&i.options.onJustify.call(i)}updateOptions(t){this.options={...this.options,...t},this.justify()}destroy(){const e=this;e.removeFromFjGalleryList(),e.justifyCount=0,e.options.onDestroy&&e.options.onDestroy.call(e),e.css(e.$container,{height:"",transition:""}),e.images.forEach(t=>{e.css(t.$item,{position:"",transform:"",transition:"",width:"",height:""})}),e.images.forEach(t=>{delete t.$item.fjGalleryImage}),delete e.$container.fjGallery}resize(){this.justify()}}function l(t,e,...i){var o=(t=("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)?[t]:t).length;let n,a=0;for(;a<o;a+=1)if("object"==typeof e||void 0===e?t[a].fjGallery||(t[a].fjGallery=new c(t[a],e)):t[a].fjGallery&&(n=t[a].fjGallery[e].apply(t[a].fjGallery,i)),void 0!==n)return n;return t}l.constructor=c;const d=o.jQuery;if(void 0!==d){const t=l.constructor.prototype.init,a=(l.constructor.prototype.init=function(){d(this.$container).data("fjGallery",this),t&&t.call(this)},l.constructor.prototype.destroy),s=(l.constructor.prototype.destroy=function(){this.$container&&d(this.$container).removeData("fjGallery"),a&&a.call(this)},function(...t){Array.prototype.unshift.call(t,this);t=l.apply(o,t);return"object"!=typeof t?t:this}),e=(s.constructor=l.constructor,d.fn.fjGallery);d.fn.fjGallery=s,d.fn.fjGallery.noConflict=function(){return d.fn.fjGallery=e,this}}return l});